#
# Makefile for creating distribution of phpMyEdit.
# Type 'make dist' for create tar-gziped and zip archiv. 
#
# Developed by Ondrej Jombik <nepto@platon.sk>
# Based on the Makefile by Lubomir Host <rajo@platon.sk>
# Copyright (c) 2002-2006 Platon Group, http://platon.sk/
# Documentation building support added by Lubomir Host [1/1/2003]
#

# $Platon: phpMyEdit/Makefile,v 1.89 2007/09/16 14:49:36 nepto Exp $

PACKAGE     = phpMyEdit
VERSION     = 5.7.1
VERSION_DIR = 5.7.1
DATE        = 2007-09-16
DATE_HUMAN  = 16th September 2007
export PACKAGE
export VERSION
export DATE
export DATE_HUMAN

#
# If you want to add directory to distribution, you must write firstly
# directory name into list (with ending slash) and than files from that
# directory.
#
# Wildcars usage is possible, but the convention allows it only for
# autogenerated files. Files in revision system such as CVS should be noted
# explicitly.
#

DISTFILES_CORE =	phpMyEdit.class.php phpMyEditSetup.php \
					extensions/ \
					extensions/phpMyEdit-mce-cal.class.php \
					extensions/phpMyEdit-report.class.php \
					extensions/phpMyEdit-slide.class.php \
					lang/ lang/* \
					images/ \
					images/pme-change.png images/pme-copy.png \
					images/pme-delete.png images/pme-view.png \
					images/alt/ \
					images/alt/pme-change.png images/alt/pme-copy.png \
					images/alt/pme-delete.png images/alt/pme-view.png \
					doc/ \
					doc/ChangeLog doc/README doc/AUTHORS doc/TODO \
					doc/COPYING doc/TESTS doc/VERSION

DISTFILES_DOC =		doc/ \
					doc/sgml/ \
					doc/sgml/configuration.fields.sgml \
					doc/sgml/configuration.general.sgml \
					doc/sgml/configuration.sgml \
					doc/sgml/defs.sgml.in doc/sgml/defs.sgml \
					doc/sgml/extensions.sgml \
					doc/sgml/installation.sgml \
					doc/sgml/introduction.sgml \
					doc/sgml/other-information.sgml \
					doc/sgml/phpMyEdit.sgml \
					doc/sgml/images \
					doc/sgml/images/id-selection.png \
					doc/sgml/images/logon.png \
					doc/sgml/images/result-script.png \
					doc/sgml/images/table-selection.png \
					doc/sgml/images/paypal-logo.png \
					doc/html/ \
					doc/html/* \
					doc/html/images/* \
					doc/pdf/ \
					doc/pdf/*

# Extension of archives
ZIP_EXT         = .zip
TGZ_EXT         = .tar.gz
                
TAR             = tar
ZIP             = zip
ZIP_ENV         = -r9
GZIP_ENV        = --best

srcdir			= .
distdir			= $(PACKAGE)-$(VERSION_DIR)
packname_core	= $(PACKAGE)-$(VERSION)
packname_doc	= $(PACKAGE)-doc-$(VERSION)
top_distdir		= $(distdir)
top_builddir	= .

all: dist

clean:
	rm -f doc/sgml/defs.sgml
	rm -rf doc/html/
	rm -rf doc/pdf

doc/VERSION: Makefile
	echo $(VERSION) > $@

doc/sgml/defs.sgml: doc/sgml/defs.sgml.in
	sed -e 's/@PACKAGE@/$(PACKAGE)/g; s/@VERSION@/$(VERSION)/g; s/@DATE@/$(DATE)/g; s/@DATE_HUMAN@/$(DATE_HUMAN)/g;' $< > $@
.PHONY: doc/sgml/defs.sgml

dist-all: dist
dist: dist-core dist-doc

dist-core: distdir-core
	GZIP=$(GZIP_ENV) $(TAR) chozf $(packname_core)$(TGZ_EXT) $(distdir)
#	ZIP=$(ZIP_ENV) $(ZIP) $(packname_core)$(ZIP_EXT) $(distdir)
	-rm -rf $(distdir)

dist-doc: distdir-doc
	GZIP=$(GZIP_ENV) $(TAR) chozf $(packname_doc)$(TGZ_EXT) $(distdir)
#	ZIP=$(ZIP_ENV) $(ZIP) $(packname_doc)$(ZIP_EXT) $(distdir)
	-rm -rf $(distdir)

distdir-core:
	@export _DISTFILES="$(DISTFILES_CORE)"; \
	make distdir

distdir-doc: documentation
	@export _DISTFILES="$(DISTFILES_DOC)"; \
	make distdir

distdir: $(_DISTFILES)
	@-rm -rf $(distdir); \
	mkdir $(distdir); \
	here=`cd $(top_builddir) && pwd`; \
	top_distdir=`cd $(distdir) && pwd`; \
	distdir=`cd $(distdir) && pwd`;
	@for file in $(_DISTFILES); do \
	  d=$(srcdir); \
	  if test -d $$d/$$file; then \
	    mkdir $(distdir)/$$file; \
	  else \
	    test -f $(distdir)/$$file \
	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
	    || cp -p $$d/$$file $(distdir)/$$file || :; \
	  fi; \
	done
	chmod -R u=rwX,g=,o=rX $(distdir)

documentation: html pdf

html: doc/sgml/defs.sgml
	@echo; \
	 echo "----------------------------------------------------"; \
	 echo "Generating HTML documentation, please be patient ..."; \
	 echo "----------------------------------------------------"; \
	 echo; \
	cd doc/									\
	&& docbook2html -o html/ "`pwd`/sgml/$(PACKAGE).sgml"	\
	&& cp -r sgml/images html/				\
	&& rm -rf html/images/CVS

pdf: doc/sgml/defs.sgml
	@echo; \
	 echo "---------------------------------------------------"; \
	 echo "Generating PDF documentation, please be patient ..."; \
	 echo "---------------------------------------------------"; \
	 echo; \
	cd doc/									\
	&& docbook2pdf -o pdf/ "`pwd`/sgml/$(PACKAGE).sgml"	\
	&& mv pdf/$(PACKAGE).pdf pdf/$(PACKAGE)-$(VERSION).pdf \
	&& rm -rf pdf/$(PACKAGE).out pdf/$(PACKAGE).aux pdf/$(PACKAGE).log

